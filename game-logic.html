<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Dodger 3D - Yertal Arcade</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js"></script>
    <style>
        :root { --glass: rgba(255, 255, 255, 0.1); --neon-blue: #00d4ff; }
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; color: white; }
        canvas { display: block; }

        /* UI Containers */
        #game-ui, #overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        .pointer { pointer-events: auto; cursor: pointer; }

        /* Top Left: Status Box */
        .status-box {
            position: absolute; top: 20px; left: 20px;
            background: rgba(0, 20, 40, 0.8);
            border: 2px solid var(--neon-blue); border-radius: 20px;
            padding: 15px; min-width: 140px; backdrop-filter: blur(10px);
        }
        .status-box div { margin: 5px 0; font-weight: bold; }
        .hearts { color: #ff4d4d; font-size: 1.2rem; }

        /* Top Right: Icons */
        .icon-bar { position: absolute; top: 20px; right: 20px; display: flex; gap: 12px; }
        .icon-btn {
            width: 45px; height: 45px; background: var(--glass);
            border: 1px solid rgba(255,255,255,0.3); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; transition: 0.3s;
        }
        .icon-btn:hover { background: var(--neon-blue); transform: scale(1.1); }

        /* Menus */
        .menu-screen {
            position: absolute; inset: 0; background: radial-gradient(circle, #102a43, #000);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            z-index: 100; pointer-events: auto;
        }
        .btn {
            padding: 15px 40px; margin: 10px; border-radius: 30px; border: none;
            background: linear-gradient(45deg, var(--neon-blue), #0055ff);
            color: white; font-weight: bold; text-transform: uppercase; transition: 0.3s;
        }
        .btn:hover { box-shadow: 0 0 20px var(--neon-blue); transform: translateY(-2px); }
        .btn-alt { background: #334e68; }

        /* Modal Styles */
        .modal {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            z-index: 200; align-items: center; justify-content: center; pointer-events: auto;
        }
        .modal-content { background: #102a43; padding: 40px; border-radius: 20px; text-align: center; border: 1px solid var(--neon-blue); }
        .login-options button { display: block; width: 100%; margin: 10px 0; padding: 10px; border-radius: 5px; border: none; cursor: pointer; font-weight: bold; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="landing-screen" class="menu-screen">
    <h1 style="font-size: 3.5rem; letter-spacing: 5px; text-shadow: 0 0 20px var(--neon-blue);">SPACE DODGER</h1>
    <button class="btn pointer" onclick="startGame()">Launch Space Dodger</button>
    <button class="btn btn-alt pointer" onclick="showHallOfFame()">Hall of Fame</button>
</div>

<div id="game-ui" class="hidden">
    <div class="status-box">
        <div id="lvl-txt">Level: 1</div>
        <div id="score-txt" style="font-size: 1.4rem; color: var(--neon-blue);">0000</div>
        <div id="hearts-txt" class="hearts">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
    </div>

    <div class="icon-bar">
        <div class="icon-btn pointer" onclick="handleGlobalHall()">üåê</div>
        <div class="icon-btn pointer" onclick="showPersonalHall()">üèÜ</div>
        <div class="icon-btn pointer" onclick="showInstructions()">‚ìò</div>
        <div id="mute-btn" class="icon-btn pointer" onclick="toggleSound()">üîä</div>
    </div>
</div>

<div id="modal" class="modal" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h2 id="modal-title"></h2>
        <div id="modal-body"></div>
        <button class="btn-alt pointer" style="margin-top:20px" onclick="closeModal()">Close</button>
    </div>
</div>

<script>
/** * GAME CONFIG & STATE 
 */
let scene, camera, renderer, rocket, clock;
let asteroids = [], stars = [], lasers = [];
let score = 0, level = 1, lives = 3, gameActive = false;
let isLoggedIn = false; // Simulated state
let soundOn = true;
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
let whirrNode = null;

function init() {
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Light
    scene.add(new THREE.AmbientLight(0xffffff, 0.6));
    const dirLight = new THREE.DirectionalLight(0xffffff, 1);
    dirLight.position.set(5, 10, 7);
    scene.add(dirLight);

    // Rocket (Grand 3D)
    const rocketGroup = new THREE.Group();
    const body = new THREE.Mesh(new THREE.CylinderGeometry(0.4, 0.6, 2.5, 16), new THREE.MeshPhongMaterial({color: 0xdddddd}));
    const nose = new THREE.Mesh(new THREE.ConeGeometry(0.4, 0.8, 16), new THREE.MeshPhongMaterial({color: 0xff0000}));
    nose.position.y = 1.6;
    rocketGroup.add(body, nose);
    
    // Fins
    for(let i=0; i<3; i++) {
        const fin = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.8, 0.5), new THREE.MeshPhongMaterial({color: 0xff0000}));
        fin.position.y = -0.8;
        fin.rotation.y = (Math.PI * 2 / 3) * i;
        fin.position.x = Math.cos(fin.rotation.y) * 0.5;
        fin.position.z = Math.sin(fin.rotation.y) * 0.5;
        rocketGroup.add(fin);
    }
    
    rocket = rocketGroup;
    rocket.rotation.x = 0; // Always point up
    scene.add(rocket);

    camera.position.z = 12;
    camera.position.y = -4;
    camera.lookAt(0, 2, 0);

    clock = new THREE.Clock();
    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });
}

/** * SOUND SYSTEM 
 */
function playSound(freq, type, dur, vol) {
    if(!soundOn) return;
    const osc = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    osc.type = type;
    osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
    g.gain.setValueAtTime(vol, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
    osc.connect(g); g.connect(audioCtx.destination);
    osc.start(); osc.stop(audioCtx.currentTime + dur);
}

function startWhirr() {
    if(!soundOn) return;
    const osc = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    osc.type = 'sawtooth';
    osc.frequency.value = 60;
    g.gain.value = 0.02;
    osc.connect(g); g.connect(audioCtx.destination);
    osc.start();
    whirrNode = { osc, g };
}

/** * LOGIN & HALL OF FAME LOGIC 
 */
function showLogin() {
    const body = `
        <p>Log in via Yertal Federation to save scores:</p>
        <div class="login-options">
            <button style="background:#db4437; color:white" onclick="doLogin()">Google</button>
            <button style="background:#4267B2; color:white" onclick="doLogin()">Facebook</button>
            <button style="background:#00a4ef; color:white" onclick="doLogin()">Microsoft</button>
        </div>`;
    openModal("Federated Login", body);
}

function doLogin() { 
    isLoggedIn = true; 
    closeModal(); 
    alert("Logged in successfully!"); 
}

function handleGlobalHall() {
    if(!isLoggedIn) showLogin();
    else openModal("Global Hall of Fame", "1. GalacticAce - 50,000<br>2. StarLord - 42,300...");
}

function showPersonalHall() {
    let content = "Your Top Scores:<br>1. 1200<br>2. 850<br>...";
    if(!isLoggedIn) content += `<br><button class="btn pointer" onclick="showLogin()">Save Scores</button>`;
    openModal("Personal Hall of Fame", content);
}

function showHallOfFame() { showPersonalHall(); }

function showInstructions() {
    openModal("Instructions", "Dodge Red Asteroids<br>Collect Yellow Stars<br>Move: Mouse or Arrows<br>Fire: Space / Click");
}

function openModal(title, body) {
    document.getElementById('modal-title').innerText = title;
    document.getElementById('modal-body').innerHTML = body;
    document.getElementById('modal').style.display = 'flex';
}

function closeModal() { document.getElementById('modal').style.display = 'none'; }

function toggleSound() {
    soundOn = !soundOn;
    document.getElementById('mute-btn').innerText = soundOn ? 'üîä' : 'üîá';
    if(whirrNode && !soundOn) { whirrNode.osc.stop(); whirrNode = null; }
    else if(gameActive && soundOn) { startWhirr(); }
}

/** * GAMEPLAY MECHANICS 
 */
function spawnAsteroid() {
    const size = Math.random() * 0.8 + 0.3;
    const geo = new THREE.DodecahedronGeometry(size, 1);
    const mat = new THREE.MeshStandardMaterial({color: 0xff3333, flatShading: true});
    const ast = new THREE.Mesh(geo, mat);
    ast.position.set((Math.random()-0.5)*18, 15, 0);
    ast.userData = { hp: Math.ceil(size * 3), pts: Math.ceil(size * 5) };
    asteroids.push(ast);
    scene.add(ast);
}

function spawnStar() {
    const geo = new THREE.OctahedronGeometry(0.3, 0);
    const star = new THREE.Mesh(geo, new THREE.MeshStandardMaterial({color: 0xffff00, emissive: 0xffff00}));
    star.position.set((Math.random()-0.5)*18, 15, 0);
    stars.push(star);
    scene.add(star);
}

function fireLaser() {
    if(!gameActive) return;
    const laser = new THREE.Mesh(new THREE.CylinderGeometry(0.05, 0.05, 1), new THREE.MeshBasicMaterial({color:0xff0000}));
    laser.position.copy(rocket.position);
    laser.position.y += 1.5;
    lasers.push(laser);
    scene.add(laser);
    playSound(400, 'square', 0.1, 0.1); // Laser Blip
}

function startGame() {
    document.getElementById('landing-screen').classList.add('hidden');
    document.getElementById('game-ui').classList.remove('hidden');
    gameActive = true;
    startWhirr();
    animate();
}

/** * ENGINE LOOP 
 */
function animate() {
    if(!gameActive) return;
    requestAnimationFrame(animate);
    const dt = clock.getDelta();
    const speed = 0.1 + (level * 0.02);

    // Spawning
    if(Math.random() < 0.03) spawnAsteroid();
    if(Math.random() < 0.01) spawnStar();

    // Logic
    asteroids.forEach((a, i) => {
        a.position.y -= speed;
        a.rotation.x += 0.02;
        if(a.position.y < -10) { 
            score += a.userData.pts; 
            scene.remove(a); asteroids.splice(i,1); 
        }
        if(a.position.distanceTo(rocket.position) < 1.2) {
            lives--;
            document.getElementById('hearts-txt').innerText = "‚ù§Ô∏è".repeat(lives);
            scene.remove(a); asteroids.splice(i,1);
            if(lives <= 0) { alert("Game Over!"); location.reload(); }
        }
    });

    stars.forEach((s, i) => {
        s.position.y -= speed * 0.8;
        s.rotation.y += 0.05;
        if(s.position.distanceTo(rocket.position) < 1) {
            score += 20;
            scene.remove(s); stars.splice(i,1);
            playSound(1000, 'sine', 0.2, 0.1);
        }
    });

    lasers.forEach((l, li) => {
        l.position.y += 0.4;
        asteroids.forEach((a, ai) => {
            if(l.position.distanceTo(a.position) < 1) {
                a.userData.hp--;
                scene.remove(l); lasers.splice(li, 1);
                if(a.userData.hp <= 0) { score += 10; scene.remove(a); asteroids.splice(ai, 1); }
            }
        });
    });

    // Leveling
    if(score >= level * 100) {
        level++;
        document.getElementById('lvl-txt').innerText = "Level: " + level;
        playSound(600, 'triangle', 0.5, 0.2); // Euphoric sound
    }

    document.getElementById('score-txt').innerText = score.toString().padStart(4, '0');
    renderer.render(scene, camera);
}

// Controls
document.addEventListener('keydown', e => {
    if(e.key === 'ArrowLeft') rocket.position.x -= 0.6;
    if(e.key === 'ArrowRight') rocket.position.x += 0.6;
    if(e.key === ' ') fireLaser();
});
document.addEventListener('mousemove', e => {
    const x = (e.clientX / window.innerWidth) * 2 - 1;
    rocket.position.x = x * 10;
});
document.addEventListener('mousedown', fireLaser);

init();
</script>
</body>
</html>
