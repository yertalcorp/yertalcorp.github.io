<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Dodger 3D</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        canvas { display: block; }
        
        /* UI Overlays */
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        
        /* Top Left: Stats Box */
        .stats-box {
            position: absolute; top: 20px; left: 20px;
            background: rgba(0, 40, 80, 0.7);
            border: 2px solid #00d4ff; border-radius: 15px;
            padding: 15px; color: white; min-width: 120px;
            backdrop-filter: blur(5px); pointer-events: auto;
        }
        .heart { color: #ff4d4d; font-size: 20px; margin-right: 5px; }

        /* Top Right: Icons */
        .icon-bar {
            position: absolute; top: 20px; right: 20px;
            display: flex; gap: 15px; pointer-events: auto;
        }
        .icon-btn {
            width: 45px; height: 45px; background: rgba(255,255,255,0.1);
            border-radius: 50%; display: flex; align-items: center;
            justify-content: center; color: white; cursor: pointer;
            border: 1px solid rgba(255,255,255,0.3); transition: 0.3s;
        }
        .icon-btn:hover { background: rgba(0, 212, 255, 0.4); transform: scale(1.1); }

        /* Landing Screen */
        #menu {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; background: radial-gradient(circle, #1b2735 0%, #090a0f 100%);
            z-index: 10; color: white; text-align: center;
        }
        button {
            padding: 15px 40px; margin: 10px; font-size: 1.2rem;
            cursor: pointer; border-radius: 30px; border: none;
            background: linear-gradient(45deg, #00d4ff, #0055ff);
            color: white; font-weight: bold; transition: 0.3s;
        }
        button:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0, 212, 255, 0.4); }
        .secondary-btn { background: #333; }
    </style>
</head>
<body>

<div id="menu">
    <h1 style="font-size: 4rem; margin-bottom: 0;">SPACE DODGER</h1>
    <p style="margin-bottom: 30px; color: #00d4ff;">Master of the Cosmos</p>
    <button onclick="startGame()">Launch Space Dodger</button>
    <button class="secondary-btn" onclick="alert('Hall of Fame coming soon!')">Hall of Fame</button>
</div>

<div id="ui-layer" style="display: none;">
    <div class="stats-box">
        <div id="level-display">Level: 1</div>
        <div id="score-display" style="font-size: 1.5rem; font-weight: bold;">0</div>
        <div id="lives-display"></div>
    </div>

    <div class="icon-bar">
        <div class="icon-btn" title="Global Hall of Fame">üåê</div>
        <div class="icon-btn" title="Personal Trophy">üèÜ</div>
        <div class="icon-btn" title="Instructions" onclick="alert('Move: Mouse or Arrows\nShoot: Space/Click\nGoal: Dodge Red, Catch Yellow!')">‚ìò</div>
        <div id="sound-toggle" class="icon-btn" onclick="toggleSound()">üîä</div>
    </div>
</div>

<script>
/**
 * GAME CONSTANTS & STATE
 */
let scene, camera, renderer, rocket, clock;
let asteroids = [], stars = [], lasers = [];
let score = 0, level = 1, lives = 3, gameActive = false;
let speedMult = 1;
let soundEnabled = true;

// Audio Contexts (Synthetic)
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function createTone(freq, type, duration, volume = 0.1) {
    if(!soundEnabled) return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = type;
    osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
    gain.gain.setValueAtTime(volume, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + duration);
}

function init() {
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Lighting
    const ambientLight = new THREE.AmbientLight(0x404040, 2);
    scene.add(ambientLight);
    const sun = new THREE.DirectionalLight(0xffffff, 2);
    sun.position.set(5, 5, 5);
    scene.add(sun);

    // Rocket (Grand 3D Design)
    const bodyGeo = new THREE.CylinderGeometry(0.5, 0.8, 3, 12);
    const bodyMat = new THREE.MeshPhongMaterial({ color: 0xcccccc, shininess: 100 });
    rocket = new THREE.Mesh(bodyGeo, bodyMat);
    
    const tip = new THREE.Mesh(new THREE.ConeGeometry(0.5, 1, 12), new THREE.MeshPhongMaterial({ color: 0xff0000 }));
    tip.position.y = 2;
    rocket.add(tip);

    const finGeo = new THREE.BoxGeometry(2, 0.5, 0.1);
    const fin = new THREE.Mesh(finGeo, bodyMat);
    rocket.add(fin);
    
    rocket.rotation.x = Math.PI / 2;
    scene.add(rocket);

    camera.position.z = 10;
    camera.position.y = -5;
    camera.lookAt(0,0,0);

    clock = new THREE.Clock();
    window.addEventListener('resize', onWindowResize);
    document.addEventListener('keydown', handleInput);
    document.addEventListener('mousemove', handleMouseMove);
    document.addEventListener('mousedown', () => shootLaser());
}

function startGame() {
    document.getElementById('menu').style.display = 'none';
    document.getElementById('ui-layer').style.display = 'block';
    gameActive = true;
    updateHearts();
    animate();
    // Rocket Whirr
    setInterval(() => { if(gameActive) createTone(100, 'sawtooth', 0.1, 0.02); }, 150);
}

function createAsteroid() {
    const size = Math.random() * 0.8 + 0.4;
    const geo = new THREE.DodecahedronGeometry(size, 1);
    const mat = new THREE.MeshStandardMaterial({ color: 0xff3333, flatShading: true });
    const ast = new THREE.Mesh(geo, mat);
    ast.position.set((Math.random() - 0.5) * 15, 15, 0);
    ast.userData = { hp: Math.ceil(size * 3), size: size };
    asteroids.push(ast);
    scene.add(ast);
}

function createStar() {
    const geo = new THREE.OctahedronGeometry(0.3, 0);
    const mat = new THREE.MeshStandardMaterial({ color: 0xffff00, emissive: 0xffff00 });
    const star = new THREE.Mesh(geo, mat);
    star.position.set((Math.random() - 0.5) * 15, 15, 0);
    stars.push(star);
    scene.add(star);
}

function shootLaser() {
    if(!gameActive) return;
    const geo = new THREE.CylinderGeometry(0.1, 0.1, 1);
    const mat = new THREE.MeshBasicMaterial({ color: 0x00ffff });
    const laser = new THREE.Mesh(geo, mat);
    laser.position.copy(rocket.position);
    laser.position.y += 2;
    lasers.push(laser);
    scene.add(laser);
    createTone(800, 'sine', 0.1, 0.1);
}

function updateHearts() {
    const container = document.getElementById('lives-display');
    container.innerHTML = '‚ù§Ô∏è'.repeat(lives);
}

function handleInput(e) {
    if(e.code === 'ArrowLeft') rocket.position.x -= 0.5;
    if(e.code === 'ArrowRight') rocket.position.x += 0.5;
    if(e.code === 'Space') shootLaser();
}

function handleMouseMove(e) {
    const x = (e.clientX / window.innerWidth) * 2 - 1;
    rocket.position.x = x * 8;
}

function onWindowResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
}

function toggleSound() {
    soundEnabled = !soundEnabled;
    document.getElementById('sound-toggle').innerText = soundEnabled ? 'üîä' : 'üîá';
}

function animate() {
    if(!gameActive) return;
    requestAnimationFrame(animate);
    const delta = clock.getDelta();

    // Spawn logic
    if(Math.random() < 0.03 * speedMult) createAsteroid();
    if(Math.random() < 0.01) createStar();

    // Movement & Collision
    asteroids.forEach((ast, index) => {
        ast.position.y -= 0.1 * speedMult;
        ast.rotation.x += 0.01;
        
        // Dodge/Miss Score
        if(ast.position.y < -10) {
            score += Math.floor(ast.userData.size * 10);
            scene.remove(ast);
            asteroids.splice(index, 1);
        }

        // Collision with Rocket
        if(ast.position.distanceTo(rocket.position) < 1.2) {
            lives--;
            updateHearts();
            scene.remove(ast);
            asteroids.splice(index, 1);
            createTone(150, 'square', 0.3, 0.2);
            if(lives <= 0) {
                alert("Game Over! Score: " + score);
                location.reload();
            }
        }
    });

    stars.forEach((star, index) => {
        star.position.y -= 0.08 * speedMult;
        star.rotation.y += 0.05;
        if(star.position.distanceTo(rocket.position) < 1) {
            score += 50;
            scene.remove(star);
            stars.splice(index, 1);
            createTone(1200, 'sine', 0.1, 0.1);
        }
    });

    lasers.forEach((l, li) => {
        l.position.y += 0.5;
        asteroids.forEach((ast, ai) => {
            if(l.position.distanceTo(ast.position) < 1) {
                ast.userData.hp--;
                scene.remove(l);
                lasers.splice(li, 1);
                if(ast.userData.hp <= 0) {
                    score += 100;
                    scene.remove(ast);
                    asteroids.splice(ai, 1);
                }
            }
        });
    });

    // Level up logic
    if(score > level * 1000) {
        level++;
        speedMult += 0.2;
        document.getElementById('level-display').innerText = "Level: " + level;
        createTone(600, 'triangle', 0.5, 0.2); // Euphoric level up
        setTimeout(() => createTone(800, 'triangle', 0.5, 0.2), 100);
    }

    document.getElementById('score-display').innerText = score;
    renderer.render(scene, camera);
}

init();
</script>
</body>
</html>
